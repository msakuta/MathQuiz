<!DOCTYPE html>
<html lang="en">
	<head>
		<title>MathQuiz</title>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<style>
			body {
				color: #000000;
				font-family:Monospace;
				font-size:15px;
				text-align:center;

				background-color: #f0f0f0;
				margin: 0px;
			}

			#container{
				position: relative;
			}

			#points{
				font-size: 25px;
			}

			table{
				background-color: #f7c0a0;
				border: 3px solid #7f7f7f;
				border-collapse: collapse;
				/* Centering */
				margin-left: auto;
				margin-right: auto;
			}
			td{background-color: #ffe0d0}
			th{background-color: #e0c0a0}
			td, th{padding: 2px; border: 2px solid #7f7f7f}
		</style>
		<script type="text/x-mathjax-config">
		MathJax.Hub.Config({
		  tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]},
		  TeX: {
			TagSide: "left",
			Macros: {
			  T: '^{\\mathrm T}',
			  RR: '{\\bf R}',
			  bold: ['{\\bf #1}',1]
			}
		  }
		});
		</script>
		<script type="text/javascript"
		 src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
		</script>
	</head>
	<body>
		<h1>MathQuiz</h1>
		<input type="button" onclick="start()" value="Start">
		<hr>
		<div id="container">

			<div id="problem">
			</div>

<input type="radio" name="answer" id="1"><span id="ans1"></span>
<input type="radio" name="answer" id="2"><span id="ans2"></span>
<input type="radio" name="answer" id="3"><span id="ans3"></span>
<input type="radio" name="answer" id="4"><span id="ans4"></span>
<p><input type="button" value="Answer" onclick="answer()"></p>
</div>
		<div id="message" style="font-size: 15pt; color: red"></div>
		<div><input type="button" id="restart" onclick="start()" value="Next Problem" style="display: none"></div>
		<div id="points"></div>
		<hr>
		<div id="highScores"></div>
		<hr>
		<div>Source on <a href="https://github.com/msakuta/MathQuiz">GitHub</a>.</div>
		<div>Powered by <a href="https://www.mathjax.org/">MathJax</a>.</div>

		<script>

// Constants
var optionCount = 4;


var correctAns;

function formatFormula(vec){
	var sign = vec[0], f = vec[1], pow = vec[2], fun = vec[3], f2 = vec[4];
	if(f === 0)
		return "0";
	// Normalize notation
	if(f < 0){
		sign *= -1;
		f *= -1;
	}

	var primary = pow === 0 ? "" : Math.abs(pow) === 1 ? "x" : "x^{" + Math.abs(pow) + "}";
	var factor = (0 < pow && f === 1 ? primary === "" ? "1" : "" : f);
	var factor2 = (f2 === 1 ? "" : f2);
	var signStr = sign < 0 ? "-" : "";
	var ret = f === 0 ? "0" : pow < 0 ? signStr + "\\frac{" + factor + "}{" + primary + "}" : signStr + factor + primary;
	if(fun !== "")
		ret += fun + "(" + factor2 + "x)";
	return ret;
}

function symbolicDerivative(vec){
	var sign = vec[0], f = vec[1], pow = vec[2], fun = vec[3], f2 = vec[4];
	switch(fun){
		case "\\sin":
			fun = "\\cos";
			f *= f2;
			break;
		case "\\cos":
			fun = "\\sin";
			f *= f2;
			sign *= -1;
			break;
	}
	if(fun === "")
		return [sign, f * pow, pow-1, fun, f2];
	else
		return [sign, f, pow, fun, f2];
}


function start(){
	var problem = document.getElementById("problem");
	var sign = (Math.floor(Math.random() * 2)) * 2 - 1;
	var f = Math.floor(Math.random() * 6);
	var fun = ["", "", "", "\\sin", "\\cos"][Math.floor(Math.random() * 5)];
	var pow = fun === "" ? Math.floor(Math.random() * 7) - 3 : 0;
	var f2 = Math.floor(Math.random() * 6) + 1;
	problem.innerHTML = "$$\\frac{d}{dx} \\left(" + formatFormula([sign, f, pow, fun, f2]) + " \\right)$$";

	var correctAnsStr = formatFormula(sign, f * pow, pow-1);

	var options = [];
	for(var i = 0; i < optionCount; i++){
		var str;
		do{
			var isign = (Math.floor(Math.random() * 2)) * 2 - 1;
			var incf = Math.floor((Math.random() * (6 * 3)));
			var ipow = Math.floor(Math.random() * 7) - 4;
			str = formatFormula(isign, incf, ipow);
			// Prevent random formulae from being "accidentally" the same as correct answer.
		}while(correctAnsStr === str);
		options[i] = str;
	}
	var permutedOptions = [];
	for(var i = 0; i < optionCount; i++){
		var idx = Math.floor(Math.random() * options.length);
		permutedOptions.push(options[idx]);
		options.splice(idx,1);
	}

	correctAns = Math.floor(Math.random() * optionCount);
	permutedOptions[correctAns] = correctAnsStr;

	for(var i = 0; i < optionCount; i++){
		var elem = document.getElementById("ans" + (i + 1));
		elem.innerHTML = "$ \\displaystyle " + permutedOptions[i] + "$";
		var radio = document.getElementById(i + 1);
		radio.checked = false;
	}

	var messageElem = document.getElementById("message");
	messageElem.innerHTML = "";

	var restartElem = document.getElementById("restart");
	restartElem.style.display = "none";

	MathJax.Hub.Typeset();
}

function answer(){
	var radio = document.getElementById(correctAns + 1);
	var message;
	if(radio.checked)
		message = "Correct";
	else
		message = "Incorrect";
	var messageElem = document.getElementById("message");
	messageElem.innerHTML = message;

	var restartElem = document.getElementById("restart");
	restartElem.style.display = radio.checked ? "inline" : "none";
}

window.onload = start;

		</script>

	</body>
</html>
